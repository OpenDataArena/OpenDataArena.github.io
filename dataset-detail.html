<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dataset Details - Data Leaderboard</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="dropdown-styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .dataset-detail-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .back-to-leaderboard {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: #1e40af;
            text-decoration: none;
            margin-bottom: 30px;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            padding: 8px 16px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            background: #ffffff;
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        }
        
        .back-to-leaderboard:hover {
            color: #1e40af;
            background: #f1f5f9;
            border-color: #cbd5e1;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            transform: translateY(-1px);
        }
        
        .dataset-header {
            background: #1e40af;
            color: white;
            padding: 40px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 10px 10px -5px rgb(0 0 0 / 0.04);
            position: relative;
            overflow: hidden;
        }
        
        .dataset-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 1px 1px, rgba(255,255,255,0.1) 1px, transparent 0),
                linear-gradient(45deg, transparent 40%, rgba(255,255,255,0.05) 50%, transparent 60%);
            background-size: 20px 20px, 40px 40px;
            animation: textureMove 20s linear infinite;
            pointer-events: none;
        }
        
        @keyframes textureMove {
            0% { transform: translateX(0) translateY(0); }
            100% { transform: translateX(20px) translateY(20px); }
        }
        
        .dataset-title {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }
        
        .dataset-affiliation {
            font-size: 1.2rem;
            opacity: 1;
            margin-bottom: 20px;
            color: rgba(255,255,255,0.95);
            font-weight: 500;
        }
        
        .dataset-basic-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .info-item {
            background: rgba(255,255,255,0.15);
            padding: 20px 15px;
            border-radius: 12px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.2);
            transition: all 0.3s ease;
        }
        
        .info-item:hover {
            background: rgba(255,255,255,0.25);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .info-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .info-value {
            font-size: 1.4rem;
            font-weight: 600;
        }
        
        .external-links {
            margin-top: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .external-link {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            border: 1px solid rgba(255,255,255,0.3);
            font-size: 0.9rem;
            font-weight: 500;
            backdrop-filter: blur(10px);
        }
        
        .external-link:hover {
            background: rgba(255,255,255,0.35);
            color: white;
            border-color: rgba(255,255,255,0.5);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }
        
        .content-section {
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.08), 0 10px 10px -5px rgb(0 0 0 / 0.04);
            margin-bottom: 30px;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .content-section:hover {
            box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.12), 0 15px 20px -5px rgb(0 0 0 / 0.08);
            transform: translateY(-2px);
        }
        
        .section-header {
            background: #f8fafc;
            padding: 25px 30px;
            border-bottom: 1px solid #e2e8f0;
            position: relative;
        }
        
        .section-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(30, 64, 175, 0.03) 2px, rgba(30, 64, 175, 0.03) 4px);
            pointer-events: none;
        }
        

        
        .section-title {
            font-size: 1.4rem;
            font-weight: 600;
            color: #111827;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-content {
            padding: 30px;
        }
        


        
        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            flex-direction: column;
            gap: 20px;
        }
        
        .error-message {
            text-align: center;
            padding: 40px;
            color: #dc3545;
        }
        

        
        .dual-charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
            margin-top: 15px;
        }
        
        .chart-container {
            margin-bottom: 0;
        }
        
        .chart-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1d4ed8;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .chart-wrapper {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            position: relative;
            height: 450px;
        }
        
        .domain-selection {
            margin-bottom: 20px;
        }
        
        .domain-tabs {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .domain-tab {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 0.6rem 1rem;
            border: 1px solid #cbd5e1;
            background: #ffffff;
            color: #6b7280;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            font-size: 0.875rem;
            font-weight: 500;
        }
        
        .domain-tab:hover {
            border-color: #1e40af;
            color: #1e40af;
            background: #f1f5f9;
        }
        
        .domain-tab.active {
            background: #1e40af;
            color: #ffffff;
            border-color: #1e40af;
        }
        
        .domain-tab input[type="checkbox"] {
            margin: 0;
            width: 14px;
            height: 14px;
        }
        
        .dynamic-chart-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1e40af;
            margin-top: 25px;
            margin-bottom: 5px;
            text-align: center;
            min-height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* Compare Section Styles */
        .compare-controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .compare-toggle-btn {
            background: none;
            border: none;
            color: #1e40af;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 0;
        }
        
        .compare-toggle-btn:hover {
            color: #1d4ed8;
        }
        
        .compare-toggle-btn .icon-circle {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #6b7280;
            transition: all 0.2s ease;
        }
        
        .compare-toggle-btn:hover .icon-circle {
            background: #1e40af;
            color: white;
        }
        
        .compare-toggle-btn.active .icon-circle {
            background: #dc2626;
            color: white;
        }
        
        .compare-selection {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
        }
        
        .compare-dropdown label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 15px;
            display: block;
        }
        
        .compare-dataset-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: white;
        }
        
        .compare-dataset-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            border-bottom: 1px solid #f3f4f6;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .compare-dataset-item:last-child {
            border-bottom: none;
        }
        
        .compare-dataset-item:hover {
            background: #f1f5f9;
        }
        
        .compare-dataset-item.selected {
            background: #dbeafe;
            border-left: 4px solid #1e40af;
        }
        
        .compare-dataset-item input[type="checkbox"] {
            margin: 0;
            width: 16px;
            height: 16px;
        }
        
        .compare-dataset-item .dataset-name {
            flex: 1;
            font-weight: 500;
            color: #111827;
        }
        
        .compare-dataset-item .dataset-domain {
            background: #e5e7eb;
            color: #374151;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .compare-actions {
            margin-top: 20px;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }
        
        .compare-update-btn {
            background: #059669;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .compare-update-btn:hover:not(:disabled) {
            background: #047857;
            transform: translateY(-1px);
        }
        
        .compare-update-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        
        .compare-clear-btn {
            background: #dc2626;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .compare-clear-btn:hover {
            background: #b91c1c;
            transform: translateY(-1px);
        }
        
        @media (max-width: 768px) {
            .dataset-title {
                font-size: 2rem;
            }
            
            .external-links {
                justify-content: center;
            }
            
            .section-content {
                padding: 20px;
            }
            

            
            .dual-charts-container {
                grid-template-columns: 1fr;
                gap: 20px;
                margin-top: 10px;
            }
            
            .chart-tabs {
                margin-bottom: 15px;
            }
            
            .chart-wrapper {
                height: 350px;
                max-width: 100%;
            }
            
            .chart-tabs {
                gap: 4px;
            }
            
            .chart-tab {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Loading State -->
        <div v-if="loading" class="loading-spinner">
            <i class="fas fa-circle-notch fa-spin fa-3x"></i>
            <p>Loading dataset information...</p>
        </div>

        <!-- Error State -->
        <div v-if="error" class="error-message">
            <i class="fas fa-exclamation-triangle fa-3x"></i>
            <h3>{{ error }}</h3>
            <p>
                <a href="index.html" class="back-to-leaderboard">
                    <i class="fas fa-arrow-left"></i> Back to Leaderboard
                </a>
            </p>
        </div>

        <!-- Dataset Detail Content -->
        <div v-if="!loading && !error && llamaDataset" class="dataset-detail-container">
            <!-- Back Link -->
            <a href="index.html" class="back-to-leaderboard">
                <i class="fas fa-arrow-left"></i> Back to Leaderboard
            </a>

            <!-- Dataset Header Information -->
            <div class="dataset-header">
                <h1 class="dataset-title">{{ llamaDataset.name }}</h1>
                <div v-if="llamaDataset.affiliation" class="dataset-affiliation">
                    <i class="fas fa-building"></i> {{ llamaDataset.affiliation }}
                </div>
                
                <div class="dataset-basic-info">
                    <div class="info-item">
                        <div class="info-label">Release Year</div>
                        <div class="info-value">{{ llamaDataset.year || 'N/A' }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Dataset Size</div>
                        <div class="info-value">{{ llamaDataset.size || 'N/A' }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Domain</div>
                        <div class="info-value">{{ getDomainDisplayName(llamaDataset.domain) }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Overall Average (Llama)</div>
                        <div class="info-value">{{ formatScore(llamaDataset.overall_avg) }}</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">Overall Average (Qwen)</div>
                        <div class="info-value">{{ formatScore(qwenDataset.overall_avg) }}</div>
                    </div>
                </div>

                <!-- 外部链接 -->
                <div class="external-links">
                    <a v-if="llamaDataset.link" :href="llamaDataset.link" target="_blank" rel="noopener noreferrer" class="external-link">
                        <i class="fab fa-github"></i> Hugging Face Dataset
                    </a>
                    <a href="index.html" class="external-link">
                        <i class="fas fa-chart-line"></i> View Leaderboard
                    </a>
                </div>
            </div>

            <!-- Compare Controls (no section wrapper) -->
            <div class="compare-controls" style="margin-bottom: 30px;">
                <button 
                    @click="toggleCompareMode" 
                    class="compare-toggle-btn"
                    :class="{ active: compareMode }">
                    <span class="icon-circle">
                        <i class="fas fa-plus" v-if="!compareMode"></i>
                        <i class="fas fa-minus" v-if="compareMode"></i>
                    </span>
                    {{ compareMode ? 'Hide Comparison' : 'Compare with Other Datasets' }}
                </button>
                
                <div v-if="compareMode" class="compare-selection">
                    <div class="compare-dropdown">
                        <label>Select datasets to compare:</label>
                        <div class="compare-dataset-list">
                            <div 
                                v-for="ds in availableDatasets" 
                                :key="ds.id"
                                class="compare-dataset-item"
                                :class="{ selected: isDatasetSelected(ds.id) }"
                                @click="toggleDatasetSelection(ds.id)">
                                <input 
                                    type="checkbox" 
                                    :checked="isDatasetSelected(ds.id)"
                                    @change="toggleDatasetSelection(ds.id)">
                                <span class="dataset-name">{{ ds.name }}</span>
                                <span class="dataset-domain">{{ getDomainDisplayName(ds.domain) }}</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="compare-actions">
                        <button 
                            @click="updateComparison" 
                            class="compare-update-btn"
                            :disabled="selectedDatasets.length === 0">
                            <i class="fas fa-sync"></i>
                            Update Comparison ({{ selectedDatasets.length }} selected)
                        </button>
                        <button 
                            @click="clearComparison" 
                            class="compare-clear-btn"
                            v-if="selectedDatasets.length > 0">
                            <i class="fas fa-times"></i>
                            Clear All
                        </button>
                    </div>
                </div>
            </div>

            <!-- Performance Scores -->
            <div class="content-section">
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-chart-bar"></i> Performance Overview
                    </h2>
                </div>
                <div class="section-content">
                    <!-- Domain Selection -->
                    <div class="domain-selection">
                        <div class="domain-tabs">
                            <div 
                                class="domain-tab"
                                :class="{ active: selectedDomains.includes('overall') }"
                                @click="toggleDomain('overall')">
                                <input 
                                    type="checkbox" 
                                    :checked="selectedDomains.includes('overall')"
                                    @change="toggleDomain('overall')">
                                <span>Overall</span>
                            </div>
                            <div 
                                v-if="llamaDataset.task_details && llamaDataset.task_details.general_tasks"
                                class="domain-tab"
                                :class="{ active: selectedDomains.includes('general') }"
                                @click="toggleDomain('general')">
                                <input 
                                    type="checkbox" 
                                    :checked="selectedDomains.includes('general')"
                                    @change="toggleDomain('general')">
                                <span>General</span>
                            </div>
                            <div 
                                v-if="llamaDataset.task_details && llamaDataset.task_details.math_tasks"
                                class="domain-tab"
                                :class="{ active: selectedDomains.includes('math') }"
                                @click="toggleDomain('math')">
                                <input 
                                    type="checkbox" 
                                    :checked="selectedDomains.includes('math')"
                                    @change="toggleDomain('math')">
                                <span>Math</span>
                            </div>
                            <div 
                                v-if="llamaDataset.task_details && llamaDataset.task_details.code_tasks"
                                class="domain-tab"
                                :class="{ active: selectedDomains.includes('code') }"
                                @click="toggleDomain('code')">
                                <input 
                                    type="checkbox" 
                                    :checked="selectedDomains.includes('code')"
                                    @change="toggleDomain('code')">
                                <span>Code</span>
                            </div>
                            <div 
                                v-if="llamaDataset.task_details && llamaDataset.task_details.reasoning_tasks"
                                class="domain-tab"
                                :class="{ active: selectedDomains.includes('reasoning') }"
                                @click="toggleDomain('reasoning')">
                                <input 
                                    type="checkbox" 
                                    :checked="selectedDomains.includes('reasoning')"
                                    @change="toggleDomain('reasoning')">
                                <span>Reasoning</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Dual Model Charts -->
                    <div class="dual-charts-container">
                        <!-- Llama Chart -->
                        <div class="chart-container">
                            <h3 class="dynamic-chart-title">Llama Model</h3>
                            <div class="chart-wrapper">
                                <canvas id="llamaRadarChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Qwen Chart -->
                        <div class="chart-container">
                            <h3 class="dynamic-chart-title">Qwen Model</h3>
                            <div class="chart-wrapper">
                                <canvas id="qwenRadarChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


        </div>
    </div>

    <script>
        const { createApp, ref, onMounted } = Vue

        const app = createApp({
            setup() {
                const loading = ref(true)
                const error = ref(null)
                const llamaDataset = ref(null)
                const qwenDataset = ref(null)
                const activeTab = ref('overall')
                const selectedDomains = ref(['overall']) // 多选领域
                let llamaChart = null
                let qwenChart = null
                
                // 比较功能相关数据
                const compareMode = ref(false)
                const selectedDatasets = ref([])
                const availableDatasets = ref([])
                const allDatasetsData = ref({})

                // 从URL参数获取数据集ID
                const getUrlParams = () => {
                    const urlParams = new URLSearchParams(window.location.search)
                    const datasetId = urlParams.get('id')
                    return { datasetId }
                }

                // 加载数据集详情
                const loadDatasetDetail = async () => {
                    try {
                        loading.value = true
                        const { datasetId } = getUrlParams()
                        
                        if (!datasetId) {
                            throw new Error('Dataset ID not specified')
                        }
                        
                        const response = await fetch('./processed_leaderboard_data.json')
                        if (!response.ok) {
                            throw new Error('Failed to load data')
                        }
                        
                        const data = await response.json()
                        allDatasetsData.value = data // 保存所有数据用于比较
                        
                        // 加载两个模型的数据
                        const llamaData = data['llama']
                        const qwenData = data['qwen']
                        
                        if (!llamaData || !qwenData) {
                            throw new Error('Model data not found')
                        }
                        
                        const llamaDataset_data = llamaData.find(d => d.id.toString() === datasetId.toString())
                        const qwenDataset_data = qwenData.find(d => d.id.toString() === datasetId.toString())
                        
                        if (!llamaDataset_data || !qwenDataset_data) {
                            throw new Error('Dataset not found in both models')
                        }
                        
                        llamaDataset.value = llamaDataset_data
                        qwenDataset.value = qwenDataset_data
                        
                        // 设置可用于比较的数据集（使用llama数据）
                        availableDatasets.value = llamaData.filter(d => d.id.toString() !== datasetId.toString())
                        
                        // 更新页面标题
                        document.title = `${llamaDataset_data.name} - Dataset Details`
                        
                        return Promise.resolve()
                        
                    } catch (err) {
                        console.error('Error loading dataset:', err)
                        error.value = err.message
                        return Promise.reject(err)
                    } finally {
                        loading.value = false
                    }
                }

                // 格式化分数
                const formatScore = (score) => {
                    if (typeof score === 'number') {
                        return (Math.round(score * 10) / 10).toFixed(1)
                    }
                    return '0.0'
                }

                // 格式化改进值
                const formatImprovement = (improvement) => {
                    if (typeof improvement === 'number') {
                        const diff = Math.round(improvement * 10) / 10
                        return diff > 0 ? `+${diff.toFixed(1)}` : `${diff.toFixed(1)}`
                    }
                    return ''
                }

                // 获取领域显示名称
                const getDomainDisplayName = (domain) => {
                    const domainNames = {
                        'general': 'General',
                        'math': 'Math',
                        'code': 'Code',
                        'reasoning': 'Reasoning',
                        'base': 'Base Model'
                    }
                    return domainNames[domain] || domain
                }

                // 比较功能方法
                const toggleCompareMode = () => {
                    compareMode.value = !compareMode.value
                    if (!compareMode.value) {
                        clearComparison()
                    }
                }

                const isDatasetSelected = (datasetId) => {
                    return selectedDatasets.value.includes(datasetId)
                }

                const toggleDatasetSelection = (datasetId) => {
                    const index = selectedDatasets.value.indexOf(datasetId)
                    if (index > -1) {
                        selectedDatasets.value.splice(index, 1)
                    } else {
                        selectedDatasets.value.push(datasetId)
                    }
                }

                const clearComparison = () => {
                    selectedDatasets.value = []
                    createDualRadarCharts()
                }

                // 多选领域功能
                const toggleDomain = (domain) => {
                    const index = selectedDomains.value.indexOf(domain)
                    if (index > -1) {
                        selectedDomains.value.splice(index, 1)
                    } else {
                        selectedDomains.value.push(domain)
                    }
                    updateCharts()
                }



                const updateCharts = () => {
                    if (selectedDatasets.value.length > 0) {
                        updateComparison()
                    } else {
                        createDualRadarCharts()
                    }
                }

                const updateComparison = () => {
                    if (selectedDatasets.value.length === 0) return
                    
                    // 获取当前数据集的多领域图表数据作为基准
                    const baseChartData = getMultiDomainChartData(llamaDataset.value)
                    if (baseChartData.labels.length === 0) return

                    // 收集Llama模型的所有数据集数据
                    const llamaDataArrays = [baseChartData.data]
                    const qwenDataArrays = [getMultiDomainChartData(qwenDataset.value).data]
                    const names = [llamaDataset.value.name]

                    // 添加选中的数据集
                    const llamaModelData = allDatasetsData.value['llama']
                    const qwenModelData = allDatasetsData.value['qwen']
                    
                    selectedDatasets.value.forEach(id => {
                        const compareLlamaDataset = llamaModelData.find(d => d.id.toString() === id.toString())
                        const compareQwenDataset = qwenModelData.find(d => d.id.toString() === id.toString())
                        
                        if (compareLlamaDataset && compareQwenDataset) {
                            const llamaCompareData = getMultiDomainChartData(compareLlamaDataset)
                            const qwenCompareData = getMultiDomainChartData(compareQwenDataset)
                            
                            llamaDataArrays.push(llamaCompareData.data)
                            qwenDataArrays.push(qwenCompareData.data)
                            names.push(compareLlamaDataset.name)
                        }
                    })

                    // 创建比较图表
                    llamaChart = createRadarChart('llamaRadarChart', baseChartData.labels, llamaDataArrays, baseChartData.title, names, llamaChart)
                    qwenChart = createRadarChart('qwenRadarChart', baseChartData.labels, qwenDataArrays, baseChartData.title, names, qwenChart)
                }

                // 为指定数据集获取多领域组合图表数据
                const getMultiDomainChartData = (datasetObj) => {
                    if (selectedDomains.value.length === 0) {
                        return { labels: [], data: [], title: 'No domains selected' }
                    }

                    const allLabels = []
                    const allData = []
                    let title = ''

                    selectedDomains.value.forEach(domain => {
                        const domainData = getChartDataForDataset(datasetObj, domain)
                        if (domainData.labels.length > 0) {
                            allLabels.push(...domainData.labels)
                            allData.push(...domainData.data)
                            if (!title) title = domainData.title
                        }
                    })

                    return {
                        labels: allLabels,
                        data: allData,
                        title: selectedDomains.value.length > 1 ? 'Multi-Domain Performance' : title
                    }
                }

                // 为指定数据集获取图表数据
                const getChartDataForDataset = (datasetObj, tabType) => {
                    switch (tabType) {
                        case 'overall':
                            return {
                                labels: ['General', 'Math', 'Code', 'Reasoning'],
                                data: [
                                    datasetObj.general_avg || 0,
                                    datasetObj.math_avg || 0,
                                    datasetObj.code_avg || 0,
                                    datasetObj.reasoning_avg || 0
                                ],
                                title: 'Overall Performance'
                            }
                        
                        case 'general':
                            if (datasetObj.task_details?.general_tasks) {
                                return {
                                    labels: datasetObj.task_details.general_tasks.map(task => task.task_name),
                                    data: datasetObj.task_details.general_tasks.map(task => task.metrics[0]?.score || 0),
                                    title: 'General Tasks Performance'
                                }
                            }
                            break
                        
                        case 'math':
                            if (datasetObj.task_details?.math_tasks) {
                                return {
                                    labels: datasetObj.task_details.math_tasks.map(task => task.task_name),
                                    data: datasetObj.task_details.math_tasks.map(task => task.metrics[0]?.score || 0),
                                    title: 'Math Tasks Performance'
                                }
                            }
                            break
                        
                        case 'code':
                            if (datasetObj.task_details?.code_tasks) {
                                const labels = []
                                const data = []
                                
                                datasetObj.task_details.code_tasks.forEach(task => {
                                    if (task.metrics && task.metrics.length > 1) {
                                        task.metrics.forEach(metric => {
                                            let shortTask = task.task_name
                                            if (shortTask === 'LiveCodeBench') shortTask = 'LCB'
                                            if (shortTask === 'humaneval') shortTask = 'HE'
                                            
                                            let shortMetric = metric.metric.replace('lcb_', '').replace('_', ' ')
                                            if (shortMetric === 'code generation') shortMetric = 'gen'
                                            if (shortMetric === 'code execution') shortMetric = 'exec'
                                            if (shortMetric === 'test output') shortMetric = 'test'
                                            if (shortMetric === 'pass@1') shortMetric = 'pass'
                                            if (shortMetric === 'score 3shot') shortMetric = 'score'
                                            
                                            labels.push(`${shortTask}\n${shortMetric}`)
                                            data.push(metric.score || 0)
                                        })
                                    } else {
                                        let shortTask = task.task_name
                                        if (shortTask === 'humaneval') shortTask = 'HE'
                                        labels.push(shortTask)
                                        data.push(task.metrics[0]?.score || 0)
                                    }
                                })
                                
                                return {
                                    labels,
                                    data,
                                    title: 'Code Tasks Performance'
                                }
                            }
                            break
                        
                        case 'reasoning':
                            if (datasetObj.task_details?.reasoning_tasks) {
                                return {
                                    labels: datasetObj.task_details.reasoning_tasks.map(task => task.task_name),
                                    data: datasetObj.task_details.reasoning_tasks.map(task => task.metrics[0]?.score || 0),
                                    title: 'Reasoning Tasks Performance'
                                }
                            }
                            break
                    }
                    
                    return { labels: [], data: [], title: '' }
                }

                // 创建单个雷达图
                const createRadarChart = (canvasId, labels, dataArrays, title, names = null, existingChart = null) => {
                    const ctx = document.getElementById(canvasId)
                    if (!ctx) return null

                    // 如果已存在图表，先销毁
                    if (existingChart) {
                        existingChart.destroy()
                    }

                    // 注册datalabels插件
                    Chart.register(ChartDataLabels);
                    
                    // 如果只有一个数据集，保持原有格式
                    if (!Array.isArray(dataArrays[0])) {
                        dataArrays = [dataArrays]
                        names = names || [title]
                    }
                    
                    // 定义颜色方案
                    const colors = [
                        { bg: 'rgba(30, 64, 175, 0.1)', border: 'rgba(30, 64, 175, 0.8)', point: 'rgba(30, 64, 175, 1)' },
                        { bg: 'rgba(220, 38, 38, 0.1)', border: 'rgba(220, 38, 38, 0.8)', point: 'rgba(220, 38, 38, 1)' },
                        { bg: 'rgba(34, 197, 94, 0.1)', border: 'rgba(34, 197, 94, 0.8)', point: 'rgba(34, 197, 94, 1)' },
                        { bg: 'rgba(251, 146, 60, 0.1)', border: 'rgba(251, 146, 60, 0.8)', point: 'rgba(251, 146, 60, 1)' },
                        { bg: 'rgba(168, 85, 247, 0.1)', border: 'rgba(168, 85, 247, 0.8)', point: 'rgba(168, 85, 247, 1)' }
                    ]
                    
                    // 创建数据集
                    const datasets = dataArrays.map((data, index) => ({
                        label: names[index] || `Dataset ${index + 1}`,
                        data: data,
                        backgroundColor: colors[index % colors.length].bg,
                        borderColor: colors[index % colors.length].border,
                        borderWidth: 2,
                        pointBackgroundColor: colors[index % colors.length].point,
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }))
                    
                    const chart = new Chart(ctx, {
                        type: 'radar',
                        data: {
                            labels: labels,
                            datasets: datasets
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: {
                                    display: datasets.length > 1,
                                    position: 'bottom',
                                    labels: {
                                        padding: 20,
                                        usePointStyle: true,
                                        font: {
                                            size: 12,
                                            weight: '500'
                                        }
                                    }
                                },
                                datalabels: {
                                    display: datasets.length === 1, // 只有单个数据集时显示
                                    align: 'end',
                                    anchor: 'end',
                                    color: '#000000',
                                    font: {
                                        size: 12,
                                        weight: '600'
                                    },
                                    formatter: (value) => {
                                        return value.toFixed(1)
                                    },
                                    offset: 8
                                }
                            },
                            scales: {
                                r: {
                                    beginAtZero: true,
                                    max: 100,
                                    grid: {
                                        color: 'rgba(30, 64, 175, 0.1)'
                                    },
                                    angleLines: {
                                        color: 'rgba(30, 64, 175, 0.15)'
                                    },
                                    pointLabels: {
                                        font: {
                                            size: 12,
                                            weight: '600',
                                            family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'
                                        },
                                        color: '#000000',
                                        padding: 20,
                                        centerPointLabels: false,
                                        display: true
                                    },
                                    ticks: {
                                        stepSize: 20,
                                        color: '#94a3b8',
                                        backdrop: {
                                            color: 'transparent'
                                        }
                                    }
                                }
                            },
                            layout: {
                                padding: {
                                    top: 45,
                                    bottom: 70,
                                    left: 70,
                                    right: 70
                                }
                            }
                        }
                    })
                    
                    return chart
                }

                // 创建双雷达图
                const createDualRadarCharts = () => {
                    if (!llamaDataset.value || !qwenDataset.value) return
                    
                    const chartData = getMultiDomainChartData(llamaDataset.value)
                    if (chartData.labels.length === 0) return
                    
                    // 创建Llama图表
                    llamaChart = createRadarChart('llamaRadarChart', chartData.labels, chartData.data, chartData.title, null, llamaChart)
                    
                    // 创建Qwen图表
                    const qwenChartData = getMultiDomainChartData(qwenDataset.value)
                    qwenChart = createRadarChart('qwenRadarChart', qwenChartData.labels, qwenChartData.data, qwenChartData.title, null, qwenChart)
                }

                // 获取图表数据 (已弃用，使用getChartDataForDataset)
                const getChartData = (tabType) => {
                    if (!llamaDataset.value) return { labels: [], data: [], title: '' }
                    return getChartDataForDataset(llamaDataset.value, tabType)
                }

                // 初始化图表
                const initializeChart = () => {
                    // 默认显示总体能力
                    createDualRadarCharts()
                }

                onMounted(() => {
                    loadDatasetDetail().then(() => {
                        // 等待 DOM 更新后创建图表
                        setTimeout(() => {
                            initializeChart()
                        }, 100)
                    })
                })

                return {
                    loading,
                    error,
                    llamaDataset,
                    qwenDataset,
                    activeTab,
                    selectedDomains,
                    formatScore,
                    formatImprovement,
                    getDomainDisplayName,
                    // 多选领域功能
                    toggleDomain,
                    // 比较功能
                    compareMode,
                    selectedDatasets,
                    availableDatasets,
                    toggleCompareMode,
                    isDatasetSelected,
                    toggleDatasetSelection,
                    updateComparison,
                    clearComparison
                }
            }
        })

        app.mount('#app')
    </script>
</body>
</html> 